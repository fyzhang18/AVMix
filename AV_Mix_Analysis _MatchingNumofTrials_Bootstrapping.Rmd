---
title: "Results_Final"
author: "Felicia Zhang"
date: "10/18/2016"
output: html_document
---

1. Prepare Data
```{r}
library(ggplot2) 
library(zoo)
library(reshape)
library(plyr)
library(scales) 
library(data.table)
library(signal)
library(matrixStats)
library(lme4)
library(arm)
library(RColorBrewer)
library(lmerTest)
library(boot)

#load data
# orig = read.csv("/Volumes/emberson/ResearchProjects/Pupillometry/AV_Mix/Data/V2/AVMix_final.csv")  
# orig <- subset(orig, TRIAL_INDEX > 0) #get rid of trial 0 (that's baseline for trial 1) 
# orig$X <- NULL

#trialtype (1=A1V1, 2=A2V2, 3=A2--, 4=--V2, 5=A3--, 6=--V3)
#poo2 = keeping samples where Ss are looking at center of screen, ~ 400 x 400 box
#screen dimensions of screen are 1280 x 1024 and image itself is 250 x 250 pixels 
poo2 <- orig
a <- which(poo2$RIGHT_GAZE_X < 440)
poo2 <- poo2[-c(a), ]
a <- which(poo2$RIGHT_GAZE_Y < 312)
poo2 <- poo2[-c(a), ]
a <- which(poo2$RIGHT_GAZE_X > 840)
poo2 <- poo2[-c(a), ]
a <- which(poo2$RIGHT_GAZE_Y > 712)
poo2 <- poo2[-c(a), ]

orig = readRDS("/Volumes/emberson/ResearchProjects/Pupillometry/AV_Mix/Data/V2/AVMix.rds")
poo2 <- orig

#colors
grouptrial <- c("#333333", "#CC0066","#FF6600","#FFcc66","#666666","#999999")
colorAV <- c("#333333", "#CC0066")
colorA <- c("#FF6600","#666666")
colorV <- c("#FFcc66","#999999")
colorVom <- c("#CC0066", "#FF6600")
colorAom <- c("#CC0066", "#FFcc66")
colortimes <- c("#0099FF", "#0033FF")
```

Matching number of trials
for each participant, select 15 trials from the 30 in the condition, average and SE that selection, do it 100 times, get grand average grand error
and plot timecourse

```{r}
#only keep trialtype 1,5,6
goo1 <- subset(poo2, trialtype == 1)
goo5 <- subset(poo2, trialtype == 5)
goo6 <- subset(poo2, trialtype == 6)
goo1 <- subset(goo1, TIMECODE < 6100)
goo5 <- subset(goo5, TIMECODE < 6100)
goo6 <- subset(goo6, TIMECODE < 6100)

trial<-c(1:30)

#for trialtype 1

subs <- unique(goo1$subID)
zoo2 <- data.frame(TIMECODE=numeric(),trialtype=numeric(),avg.pupil=numeric(),sePupil=numeric(),iteration=numeric())

for (j in 1:100){
print(j)
zoo1 <- data.frame(RECORDING_SESSION_LABEL=numeric(),HTARGET_X=numeric(),HTARGET_Y=numeric(),LEFT_GAZE_X=numeric(),LEFT_GAZE_Y=numeric(),LEFT_IN_BLINK=numeric(),LEFT_PUPIL_SIZE=numeric(),RIGHT_GAZE_X=numeric(),RIGHT_GAZE_Y=numeric(),RIGHT_IN_BLINK=numeric(),RIGHT_PUPIL_SIZE=numeric(),SAMPLE_INDEX=numeric(),SAMPLE_MESSAGE=character(),TIMESTAMP=numeric(),TRIAL_INDEX=numeric(),trialtype=numeric(),subID=numeric(),TIMECODE=numeric(),orig=numeric(),rleLength=numeric(),percentmissing=numeric(),percentmissing.sub=numeric(),timesseen=numeric(),PUPIL_CORRECTED=numeric())
for (i in 1:length(subs)) { #for each subject
  coo <- subset(goo1, subID == subs[i])
  s <- sample(trial, 15, replace=FALSE) #randomly select 15 trials w/o replacement
  coo2 <- coo[coo$timesseen %in% s,] #keeps only those trials
  zoo1 <- rbind(zoo1,coo2)
}
#calculate mean and SE for one iteration
doo <- ddply(zoo1,.(subID,TIMECODE,trialtype),summarise,avg.pupilSs=mean(PUPIL_CORRECTED,na.rm = TRUE)) 
doo2 <- ddply(doo,.(TIMECODE,trialtype),summarise,avg.pupil=mean(avg.pupilSs,na.rm = TRUE),sePupil=sd(avg.pupilSs, na.rm = TRUE)/sqrt(length(avg.pupilSs))) #collapse across trials
doo2$iteration <- j
zoo2 <- rbind(zoo2,doo2)
}
trial1 <- zoo2

#for trialtype 5

subs <- unique(goo5$subID)
zoo2 <- data.frame(TIMECODE=numeric(),trialtype=numeric(),avg.pupil=numeric(),sePupil=numeric(),iteration=numeric())

for (j in 59:100){
print(j)
zoo1 <- data.frame(RECORDING_SESSION_LABEL=numeric(),HTARGET_X=numeric(),HTARGET_Y=numeric(),LEFT_GAZE_X=numeric(),LEFT_GAZE_Y=numeric(),LEFT_IN_BLINK=numeric(),LEFT_PUPIL_SIZE=numeric(),RIGHT_GAZE_X=numeric(),RIGHT_GAZE_Y=numeric(),RIGHT_IN_BLINK=numeric(),RIGHT_PUPIL_SIZE=numeric(),SAMPLE_INDEX=numeric(),SAMPLE_MESSAGE=character(),TIMESTAMP=numeric(),TRIAL_INDEX=numeric(),trialtype=numeric(),subID=numeric(),TIMECODE=numeric(),orig=numeric(),rleLength=numeric(),percentmissing=numeric(),percentmissing.sub=numeric(),timesseen=numeric(),PUPIL_CORRECTED=numeric())
for (i in 1:length(subs)) { #for each subject
  coo <- subset(goo5, subID == subs[i])
  s <- sample(trial, 15, replace=FALSE) #randomly select 15 trials w/o replacement
  coo2 <- coo[coo$timesseen %in% s,] #keeps only those trials
  zoo1 <- rbind(zoo1,coo2)
}
#calculate mean and SE for one iteration
doo <- ddply(zoo1,.(subID,TIMECODE,trialtype),summarise,avg.pupilSs=mean(PUPIL_CORRECTED,na.rm = TRUE)) 
doo2 <- ddply(doo,.(TIMECODE,trialtype),summarise,avg.pupil=mean(avg.pupilSs,na.rm = TRUE),sePupil=sd(avg.pupilSs, na.rm = TRUE)/sqrt(length(avg.pupilSs))) #collapse across trials
doo2$iteration <- j
zoo2 <- rbind(zoo2,doo2)
}
trial5 <- zoo2

#for trialtype 6

subs <- unique(goo6$subID)
zoo2 <- data.frame(TIMECODE=numeric(),trialtype=numeric(),avg.pupil=numeric(),sePupil=numeric(),iteration=numeric())

for (j in 1:100){
print(j)
zoo1 <- data.frame(RECORDING_SESSION_LABEL=numeric(),HTARGET_X=numeric(),HTARGET_Y=numeric(),LEFT_GAZE_X=numeric(),LEFT_GAZE_Y=numeric(),LEFT_IN_BLINK=numeric(),LEFT_PUPIL_SIZE=numeric(),RIGHT_GAZE_X=numeric(),RIGHT_GAZE_Y=numeric(),RIGHT_IN_BLINK=numeric(),RIGHT_PUPIL_SIZE=numeric(),SAMPLE_INDEX=numeric(),SAMPLE_MESSAGE=character(),TIMESTAMP=numeric(),TRIAL_INDEX=numeric(),trialtype=numeric(),subID=numeric(),TIMECODE=numeric(),orig=numeric(),rleLength=numeric(),percentmissing=numeric(),percentmissing.sub=numeric(),timesseen=numeric(),PUPIL_CORRECTED=numeric())
for (i in 1:length(subs)) { #for each subject
  coo <- subset(goo6, subID == subs[i])
  s <- sample(trial, 15, replace=FALSE) #randomly select 15 trials w/o replacement
  coo2 <- coo[coo$timesseen %in% s,] #keeps only those trials
  zoo1 <- rbind(zoo1,coo2)
}
#calculate mean and SE for one iteration
doo <- ddply(zoo1,.(subID,TIMECODE,trialtype),summarise,avg.pupilSs=mean(PUPIL_CORRECTED,na.rm = TRUE)) 
doo2 <- ddply(doo,.(TIMECODE,trialtype),summarise,avg.pupil=mean(avg.pupilSs,na.rm = TRUE),sePupil=sd(avg.pupilSs, na.rm = TRUE)/sqrt(length(avg.pupilSs))) #collapse across trials
doo2$iteration <- j
zoo2 <- rbind(zoo2,doo2)
}
trial6 <- zoo2

write.csv(trial1, "trial1_100x.csv", row.names=TRUE) #save to
write.csv(trial5, "trial5_100x.csv", row.names=TRUE) #save to
write.csv(trial6, "trial6_100x.csv", row.names=TRUE) #save to
```

Creating final timecourse dataframe
```{r}
trial1 <- read.csv("/Volumes/emberson/ResearchProjects/Pupillometry/AV_Mix/Data/V2/trial1_100x.csv")
trial5 <- read.csv("/Volumes/emberson/ResearchProjects/Pupillometry/AV_Mix/Data/V2/trial5_100x.csv")
trial6 <- read.csv("/Volumes/emberson/ResearchProjects/Pupillometry/AV_Mix/Data/V2/trial6_100x.csv")

#get grand average for trial1, trial5, trial6
boo1 <- ddply(trial1,.(TIMECODE,trialtype),summarise,grandPupil=mean(avg.pupil,na.rm = TRUE),grandSE=mean(sePupil,na.rm = TRUE)) 
boo5 <- ddply(trial5,.(TIMECODE,trialtype),summarise,grandPupil=mean(avg.pupil,na.rm = TRUE),grandSE=mean(sePupil,na.rm = TRUE)) 
boo6 <- ddply(trial6,.(TIMECODE,trialtype),summarise,grandPupil=mean(avg.pupil,na.rm = TRUE),grandSE=mean(sePupil,na.rm = TRUE)) 

#rename labels
names(boo1)[3] <- "avg.pupil"
names(boo1)[4] <- "sePupil"
names(boo5)[3] <- "avg.pupil"
names(boo5)[4] <- "sePupil"
names(boo6)[3] <- "avg.pupil"
names(boo6)[4] <- "sePupil"

poo5 <- subset(poo2, TIMECODE < 6000)
doo <- ddply(poo5,.(subID,TIMECODE,trialtype),summarise,avg.pupilSs=mean(PUPIL_CORRECTED,na.rm = TRUE)) 
doo2 <- ddply(doo,.(TIMECODE,trialtype),summarise,avg.pupil=mean(avg.pupilSs,na.rm = TRUE),sePupil=sd(avg.pupilSs, na.rm = TRUE)/sqrt(length(avg.pupilSs))) #collapse across trials

#combine with iterations
doo3 <-subset(doo2, trialtype > 1 & trialtype < 5)
tc.100 <- rbind(doo3,boo1,boo5,boo6)

```

Timecourse graph: all trialtypes
```{r}
aa = c(0,1000)
a = 2000

ggplot(tc.100,aes(x=TIMECODE,y=avg.pupil,fill=factor(trialtype),colour=factor(trialtype)))+
  geom_line()+ggtitle("Timecourse")+
  theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),axis.line = element_line(colour = "black"))+
  labs(x = "Time (ms)", y = "Pupil change from baseline (%)")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  scale_y_continuous(labels=percent,limits=c(-0.1,.1),breaks=seq(-0.1,0.1,0.02))+
  scale_x_continuous(limits=c(0,6000),breaks=seq(0,6000,500))+
  geom_ribbon(aes(ymin=avg.pupil-sePupil,ymax=avg.pupil+sePupil),alpha=0.5)+
  scale_fill_manual(values=grouptrial,name="Trial Type", breaks=c("1", "2","3","4","5","6"),labels=c("A1V1", "A2V2", "A2--","--V2","A3--","--V3"))+
  scale_colour_manual(values=grouptrial)+guides(color=FALSE)+
  geom_vline(xintercept = aa, size = 1)+geom_vline(xintercept = a, linetype = "longdash")

#facet wrap
label <- c(`1` = "A1V1",`2` = "A2V2",`3` = "A2--",`4` = "--V2",`5` = "A3--",`6` = "--V3")
ggplot(tc.100,aes(x=TIMECODE,y=avg.pupil,fill=factor(trialtype),colour=factor(trialtype)))+
  geom_line()+ggtitle("Timecourse")+
  theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),axis.line = element_line(colour = "black"))+
  labs(x = "Time (ms)", y = "Pupil change from baseline (%)")+
  theme(plot.title = element_text(face="bold", size=14, hjust=0))+
  theme(axis.title = element_text(face="bold", size=14))+ 
  theme(axis.text.x  = element_text(size=14),axis.text.y  = element_text(size=14))+
  theme(legend.text=element_text(size=14),legend.title=element_text(size=14))+
  scale_y_continuous(labels=percent,limits=c(-0.1,.1),breaks=seq(-0.1,0.1,0.02))+
  scale_x_continuous(limits=c(0,6000),breaks=seq(0,6000,500))+
  geom_ribbon(aes(ymin=avg.pupil-sePupil,ymax=avg.pupil+sePupil),alpha=0.5)+
  theme(legend.position="none")+
  facet_wrap(~trialtype,ncol=2,labeller = as_labeller(label))+
  theme(strip.text = element_text(size=16))+
  scale_fill_manual(values=grouptrial)+scale_colour_manual(values=grouptrial)+
  geom_vline(xintercept = aa, size = 1)+geom_vline(xintercept = a, linetype = "longdash")

#can we make A2V2 when we combine A2 and V2? (trialtype 2,3,4)
x1 <- subset(poo2, trialtype > 1 & trialtype < 5)
#version 1: get average
x2 <- ddply(x1,.(subID,TIMECODE,trialtype),summarise,Pupilavg=mean(PUPIL_CORRECTED,na.rm = TRUE))
x22 <- ddply(x2,.(TIMECODE,trialtype),summarise,avgPupil=mean(Pupilavg,na.rm = TRUE),sePupil=sd(Pupilavg, na.rm = TRUE)/sqrt(length(Pupilavg)))
x22$group <- 2
x22$group[x22$trialtype==2] <- 1

x222 <- ddply(x22,.(TIMECODE,group),summarise,avgPupil2=mean(avgPupil,na.rm = TRUE), sePupil2=mean(sePupil,na.rm = TRUE))

ggplot(x222,aes(x=TIMECODE,y=avgPupil2,fill=factor(group),colour=factor(group)))+
  geom_line()+ggtitle("A2V2 vs A2+V2")+
  theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),axis.line = element_line(colour = "black"))+
  labs(x = "Time (ms)", y = "Pupil change from baseline (%)")+
  theme(plot.title = element_text(face="bold", size=14, hjust=0))+
  theme(axis.title = element_text(face="bold", size=14))+ 
  theme(axis.text.x  = element_text(size=14),axis.text.y  = element_text(size=14))+
  theme(legend.text=element_text(size=14),legend.title=element_text(size=14))+
  scale_y_continuous(labels=percent,limits=c(-0.1,.1),breaks=seq(-0.1,0.1,0.02))+
  scale_x_continuous(limits=c(0,6000),breaks=seq(0,6000,500))+
  geom_ribbon(aes(ymin=avgPupil2-sePupil2,ymax=avgPupil2+sePupil2),alpha=0.5)+
  guides(color=FALSE)+
  scale_fill_brewer(palette="Dark2",name="Trial Type", breaks=c("1", "2"),labels=c("A2V2", "A2+V2"))+scale_colour_brewer(palette="Dark2")+
  geom_vline(xintercept = aa, size = 1)+geom_vline(xintercept = a, linetype = "longdash")
  
#can we make A1V1 when we combine A3 and V3? (trialtype 1,5,6)
x1 <- subset(poo2, trialtype == 1 | trialtype > 4)
#version 1: get average
x2 <- ddply(x1,.(subID,TIMECODE,trialtype),summarise,Pupilavg=mean(PUPIL_CORRECTED,na.rm = TRUE))
x22 <- ddply(x2,.(TIMECODE,trialtype),summarise,avgPupil=mean(Pupilavg,na.rm = TRUE),sePupil=sd(Pupilavg, na.rm = TRUE)/sqrt(length(Pupilavg)))
x22$group <- 2
x22$group[x22$trialtype==1] <- 1

x222 <- ddply(x22,.(TIMECODE,group),summarise,avgPupil2=mean(avgPupil,na.rm = TRUE), sePupil2=mean(sePupil,na.rm = TRUE))

ggplot(x222,aes(x=TIMECODE,y=avgPupil2,fill=factor(group),colour=factor(group)))+
  geom_line()+ggtitle("A1V1 vs A3+V3")+
  theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),axis.line = element_line(colour = "black"))+
  labs(x = "Time (ms)", y = "Pupil change from baseline (%)")+
  theme(plot.title = element_text(face="bold", size=14, hjust=0))+
  theme(axis.title = element_text(face="bold", size=14))+ 
  theme(axis.text.x  = element_text(size=14),axis.text.y  = element_text(size=14))+
  theme(legend.text=element_text(size=14),legend.title=element_text(size=14))+
  scale_y_continuous(labels=percent,limits=c(-0.1,.1),breaks=seq(-0.1,0.1,0.02))+
  scale_x_continuous(limits=c(0,6000),breaks=seq(0,6000,500))+
  geom_ribbon(aes(ymin=avgPupil2-sePupil2,ymax=avgPupil2+sePupil2),alpha=0.5)+
  guides(color=FALSE)+
  scale_fill_brewer(palette="Dark2",name="Trial Type", breaks=c("1", "2"),labels=c("A1V1", "A3+V3"))+scale_colour_brewer(palette="Dark2")+
  geom_vline(xintercept = aa, size = 1)+geom_vline(xintercept = a, linetype = "longdash")
 
```

Timecourse of first trial for each trial type
```{r}
poo3 <- subset(poo2, timesseen==1)

v1 <- ddply(poo3,.(TIMECODE,trialtype),summarise,avg.pupil=mean(PUPIL_CORRECTED,na.rm = TRUE),sePupil=sd(PUPIL_CORRECTED, na.rm = TRUE)/sqrt(length(PUPIL_CORRECTED)))
aa = c(0,1000)
a = 2000

ggplot(v1,aes(x=TIMECODE,y=avg.pupil,fill=factor(trialtype),colour=factor(trialtype)))+
  geom_line()+ggtitle("Timecourse for first time seeing trial")+
  theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),axis.line = element_line(colour = "black"))+
  labs(x = "Time (ms)", y = "Pupil change from baseline (%)")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  scale_x_continuous(limits=c(0,6000),breaks=seq(0,6000,500))+
  geom_ribbon(aes(ymin=avg.pupil-sePupil,ymax=avg.pupil+sePupil),alpha=0.5)+
  scale_fill_manual(values=grouptrial,name="Trial Type", breaks=c("1", "2","3","4","5","6"),labels=c("A1V1", "A2V2", "A2--","--V2","A3--","--V3"))+
  scale_colour_manual(values=grouptrial)+
  guides(color=FALSE)+
  geom_vline(xintercept = aa, size = 1)+
  geom_vline(xintercept = a, linetype = "longdash")+
  scale_y_continuous(labels=percent,limits=c(-0.2,.2),breaks=seq(-0.2,0.2,0.05))

#facet wrap
label <- c(`1` = "A1V1",`2` = "A2V2",`3` = "A2--",`4` = "--V2",`5` = "A3--",`6` = "--V3")
ggplot(v1,aes(x=TIMECODE,y=avg.pupil,fill=factor(trialtype),colour=factor(trialtype)))+
  geom_line()+ggtitle("Timecourse for first time seeing trial")+
  theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),axis.line = element_line(colour = "black"))+
  labs(x = "Time (ms)", y = "Pupil change from baseline (%)")+
  theme(plot.title = element_text(face="bold", size=14, hjust=0))+
  theme(axis.title = element_text(face="bold", size=14))+ 
  theme(axis.text.x  = element_text(size=14),axis.text.y  = element_text(size=14))+
  theme(legend.text=element_text(size=14),legend.title=element_text(size=14))+
  scale_y_continuous(labels=percent,limits=c(-0.2,.2),breaks=seq(-0.2,0.2,0.05))+
  scale_x_continuous(limits=c(0,6000),breaks=seq(0,6000,500))+
  geom_ribbon(aes(ymin=avg.pupil-sePupil,ymax=avg.pupil+sePupil),alpha=0.5)+
  theme(legend.position="none")+
  facet_wrap(~trialtype,ncol=2,labeller = as_labeller(label))+
  theme(strip.text = element_text(size=16))+
  scale_fill_manual(values=grouptrial)+scale_colour_manual(values=grouptrial)+
  geom_vline(xintercept = aa, size = 1)+geom_vline(xintercept = a, linetype = "longdash")

#only looking at trialtype 2-4

v2 <- subset(v1, trialtype > 1 & trialtype < 5 & TIMECODE < 6001)

ggplot(v2,aes(x=TIMECODE,y=avg.pupil,fill=factor(trialtype),colour=factor(trialtype)))+
  geom_line()+ggtitle("Timecourse for first time seeing trial")+
  theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),axis.line = element_line(colour = "black"))+
  labs(x = "Time (ms)", y = "Pupil change from baseline (%)")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  scale_x_continuous(limits=c(0,6000),breaks=seq(0,6000,500))+
  geom_ribbon(aes(ymin=avg.pupil-sePupil,ymax=avg.pupil+sePupil),alpha=0.5)+
  scale_fill_brewer(palette="Pastel2",name="Trial Type", breaks=c("2","3","4"),labels=c("A2V2", "A2--","--V2"))+
  scale_colour_brewer(palette="Pastel2")+guides(color=FALSE)+
  geom_vline(xintercept = aa, size = 1)+geom_vline(xintercept = a, linetype = "longdash")+
  scale_y_continuous(labels=percent,limits=c(-0.2,.2),breaks=seq(-0.2,0.2,0.05))

```

Compare timecourse of first trial and 5th, and 10th, each trial type
```{r}
poo4 <- subset(poo2, timesseen==1 |  timesseen==3 | timesseen==5 | timesseen==10)

v1 <- ddply(poo4,.(TIMECODE,trialtype,timesseen),summarise,avg.pupil=mean(PUPIL_CORRECTED,na.rm = TRUE),sePupil=sd(PUPIL_CORRECTED, na.rm = TRUE)/sqrt(length(PUPIL_CORRECTED)))
aa = c(0,1000)
a = 2000
label <- c(`1` = "A1V1",`2` = "A2V2",`3` = "A2--",`4` = "--V2",`5` = "A3--",`6` = "--V3")

ggplot(v1,aes(x=TIMECODE,y=avg.pupil,fill=factor(timesseen),colour=factor(timesseen)))+
  geom_line()+
  theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),axis.line = element_line(colour = "black"))+
  labs(x = "Time (ms)", y = "Pupil change from baseline (%)")+
  theme(plot.title = element_text(face="bold", size=14, hjust=0))+
  theme(axis.title = element_text(face="bold", size=14))+ 
  theme(axis.text.x  = element_text(size=14),axis.text.y  = element_text(size=14))+
  theme(legend.text=element_text(size=14),legend.title=element_text(size=14))+
  scale_y_continuous(labels=percent,limits=c(-0.2,.2),breaks=seq(-0.2,0.2,0.05))+
  scale_x_continuous(limits=c(0,6000),breaks=seq(0,6000,500))+
  geom_ribbon(aes(ymin=avg.pupil-sePupil,ymax=avg.pupil+sePupil),alpha=0.5)+
  facet_wrap(~trialtype,ncol=2,labeller = as_labeller(label))+
  theme(strip.text = element_text(size=16))+
  geom_vline(xintercept = aa, size = 1)+
  geom_vline(xintercept = a, linetype = "longdash")+
  scale_fill_brewer(palette="Purples",name="Number of times seen", breaks=c("1", "3","5","10"),labels=c("1st time", "3rd time", "5th time","10th time"))+
  scale_colour_brewer(palette="Purples")+
  guides(color=FALSE)+
  theme(legend.position = "bottom")

```

How does uncertainty influence the PDR? Is it different for audio vs visual domain?
```{r}
aa = c(0,1000)
a = 2000
#1. comparing A1V1 to A2V2, trialtype 1 and 2
#only care about first 6000ms
doo3 <- subset(tc.100, trialtype < 3)

ggplot(doo3,aes(x=TIMECODE,y=avg.pupil,fill=factor(trialtype),colour=factor(trialtype)))+
  geom_line()+ggtitle("A1V1 vs A2V2")+
  theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),axis.line = element_line(colour = "black"))+
  labs(x = "Time (ms)", y = "Pupil change from baseline (%)")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  scale_y_continuous(labels=percent,limits=c(-0.1,.1),breaks=seq(-0.1,0.1,0.02))+
  scale_x_continuous(limits=c(0,6000),breaks=seq(0,6000,500))+
  geom_ribbon(aes(ymin=avg.pupil-sePupil,ymax=avg.pupil+sePupil),alpha=0.3)+
  scale_fill_manual(values=colorAV,name="Trial Type", breaks=c("1", "2"),labels=c("A1V1", "A2V2"))+guides(color=FALSE)+geom_vline(xintercept = aa, size = 1)+geom_vline(xintercept = a, linetype = "longdash")+scale_colour_manual(values=colorAV)

#2.  comparing A2-- to A3--
doo4 <- subset(tc.100, trialtype== 3 | trialtype== 5)
ggplot(doo4,aes(x=TIMECODE,y=avg.pupil,fill=factor(trialtype),colour=factor(trialtype)))+
  geom_line()+ggtitle("A2-- to A3--")+
  theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),axis.line = element_line(colour = "black"))+
  labs(x = "Time (ms)", y = "Pupil change from baseline (%)")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  scale_y_continuous(labels=percent,limits=c(-0.1,.1),breaks=seq(-0.1,0.1,0.02))+
  scale_x_continuous(limits=c(0,6000),breaks=seq(0,6000,500))+
  geom_ribbon(aes(ymin=avg.pupil-sePupil,ymax=avg.pupil+sePupil),alpha=0.3)+
  scale_fill_manual(values=colorA,name="Trial Type", breaks=c("3","5"),labels=c("A2--","A3--"))+
  guides(color=FALSE)+geom_vline(xintercept = aa, size = 1)+geom_vline(xintercept = a, linetype = "longdash")+scale_colour_manual(values=colorA)

#3.  comparing V2-- to V3--
doo5 <- subset(tc.100, trialtype== 4 | trialtype== 6)
ggplot(doo5,aes(x=TIMECODE,y=avg.pupil,fill=factor(trialtype),colour=factor(trialtype)))+
  geom_line()+ggtitle("V2-- to V3--")+
  theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),axis.line = element_line(colour = "black"))+
  labs(x = "Time (ms)", y = "Pupil change from baseline (%)")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  scale_y_continuous(labels=percent,limits=c(-0.1,.1),breaks=seq(-0.1,0.1,0.02))+
  scale_x_continuous(limits=c(0,6000),breaks=seq(0,6000,500))+
  geom_ribbon(aes(ymin=avg.pupil-sePupil,ymax=avg.pupil+sePupil),alpha=0.3)+
  scale_fill_manual(values=colorV,name="Trial Type", breaks=c("4","6"),labels=c("--V2","--V3"))+
  guides(color=FALSE)+geom_vline(xintercept = aa, size = 1)+geom_vline(xintercept = a, linetype = "longdash")+scale_colour_manual(values=colorV)

```

How does the PDR look for a visual omission?
```{r}
aa = c(0,1000)
a = 2000
#1. comparing A2V2 with A2— (1=A1V1, 2=A2V2, 3=A2--, 4=--V2, 5=A3--, 6=--V3)
doo3 <- subset(tc.100, trialtype < 4 & trialtype > 1) #trialtypes 2 and 3

ggplot(doo3,aes(x=TIMECODE,y=avg.pupil,fill=factor(trialtype),colour=factor(trialtype)))+
  geom_line()+ggtitle("A2V2 vs A2--")+
  theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),axis.line = element_line(colour = "black"))+
  labs(x = "Time (ms)", y = "Pupil change from baseline (%)")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  scale_y_continuous(labels=percent,limits=c(-0.1,.1),breaks=seq(-0.1,0.1,0.02))+
  scale_x_continuous(limits=c(0,6000),breaks=seq(0,6000,500))+
  geom_ribbon(aes(ymin=avg.pupil-sePupil,ymax=avg.pupil+sePupil),alpha=0.3)+
  scale_fill_manual(values=colorVom,name="Trial Type", breaks=c("2", "3"),labels=c("A2V2", "A2--"))+guides(color=FALSE)+geom_vline(xintercept = aa, size = 1)+geom_vline(xintercept = a, linetype = "longdash")+scale_colour_manual(values=colorVom)

```

How does the PDR look for a auditory omission?
```{r}
aa = c(0,1000)
a = 2000
#1. comparing A2V2 with —V2 (1=A1V1, 2=A2V2, 3=A2--, 4=--V2, 5=A3--, 6=--V3)
doo3 <- subset(tc.100, trialtype == 2 | trialtype == 4) #trialtypes 2 and 4

ggplot(doo3,aes(x=TIMECODE,y=avg.pupil,fill=factor(trialtype),colour=factor(trialtype)))+
  geom_line()+ggtitle("A2V2 vs --V2")+
  theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),axis.line = element_line(colour = "black"))+
  labs(x = "Time (ms)", y = "Pupil change from baseline (%)")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  scale_y_continuous(labels=percent,limits=c(-0.1,.1),breaks=seq(-0.1,0.1,0.02))+
  scale_x_continuous(limits=c(0,6000),breaks=seq(0,6000,500))+
  geom_ribbon(aes(ymin=avg.pupil-sePupil,ymax=avg.pupil+sePupil),alpha=0.3)+
  scale_fill_manual(values=colorAom,name="Trial Type", breaks=c("2", "4"),labels=c("A2V2", "--V2"))+guides(color=FALSE)+geom_vline(xintercept = aa, size = 1)+geom_vline(xintercept = a, linetype = "longdash")+scale_colour_manual(values=colorAom)

```

How does familiarity influence the PDR? Is it different for audio vs visual domain?
group trials 1-7,8-15

```{r}
z1 <- subset(poo2, timesseen < 8) #group 1:1-7
z2 <- subset(poo2, timesseen > 7 & timesseen < 16) #group 2:8-15

aa = c(0,1000)
a = 2000

y1 <- ddply(z1,.(subID,TIMECODE,trialtype),summarise,avg.pupil=mean(PUPIL_CORRECTED,na.rm = TRUE))
y11 <- ddply(y1,.(TIMECODE,trialtype),summarise,AVGpupil=mean(avg.pupil,na.rm = TRUE),sePupil=sd(avg.pupil, na.rm = TRUE)/sqrt(length(avg.pupil)))
y11$group <- 1

y2 <- ddply(z2,.(subID,TIMECODE,trialtype),summarise,avg.pupil=mean(PUPIL_CORRECTED,na.rm = TRUE))
y21 <- ddply(y2,.(TIMECODE,trialtype),summarise,AVGpupil=mean(avg.pupil,na.rm = TRUE),sePupil=sd(avg.pupil, na.rm = TRUE)/sqrt(length(avg.pupil)))
y21$group <- 2

yfinal <- rbind(y11,y21)

label <- c(`1` = "A1V1",`2` = "A2V2",`3` = "A2--",`4` = "--V2",`5` = "A3--",`6` = "--V3")

#look at familiarity for different trial types
ggplot(yfinal,aes(x=TIMECODE,y=AVGpupil,fill=factor(group),colour=factor(group)))+
  geom_line()+
  theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),axis.line = element_line(colour = "black"))+
  labs(x = "Time (ms)", y = "Pupil change from baseline (%)")+
  theme(plot.title = element_text(face="bold", size=14, hjust=0))+
  theme(axis.title = element_text(face="bold", size=14))+ 
  theme(axis.text.x  = element_text(size=14),axis.text.y  = element_text(size=14))+
  theme(legend.text=element_text(size=14),legend.title=element_text(size=14))+
  scale_y_continuous(labels=percent,limits=c(-0.15,.15),breaks=seq(-0.15,0.15,0.03))+
  scale_x_continuous(limits=c(0,6000),breaks=seq(0,6000,500))+
  geom_ribbon(aes(ymin=AVGpupil-sePupil,ymax=AVGpupil+sePupil),alpha=0.5)+
  facet_wrap(~trialtype,ncol=2,labeller = as_labeller(label))+
  theme(strip.text = element_text(size=16))+
  geom_vline(xintercept = aa, size = 1)+
  geom_vline(xintercept = a, linetype = "longdash")+
  scale_fill_manual(values=colortimes,name="Number of times seen", breaks=c("1", "2"),labels=c("1-7", "8-15"))+
  scale_colour_manual(values=colortimes)+
  guides(color=FALSE)+
  theme(legend.position = "bottom")

#group all trial types together
y1 <- ddply(z1,.(subID,TIMECODE),summarise,avg.pupil=mean(PUPIL_CORRECTED,na.rm = TRUE))
y11 <- ddply(y1,.(TIMECODE),summarise,AVGpupil=mean(avg.pupil,na.rm = TRUE),sePupil=sd(avg.pupil, na.rm = TRUE)/sqrt(length(avg.pupil)))
y11$group <- 1

y2 <- ddply(z2,.(subID,TIMECODE),summarise,avg.pupil=mean(PUPIL_CORRECTED,na.rm = TRUE))
y21 <- ddply(y2,.(TIMECODE),summarise,AVGpupil=mean(avg.pupil,na.rm = TRUE),sePupil=sd(avg.pupil, na.rm = TRUE)/sqrt(length(avg.pupil)))
y21$group <- 2

yfinal <- rbind(y11,y21)
ggplot(yfinal,aes(x=TIMECODE,y=AVGpupil,fill=factor(group),colour=factor(group)))+
  geom_line()+
  theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),axis.line = element_line(colour = "black"))+
  labs(x = "Time (ms)", y = "Pupil change from baseline (%)")+
  theme(plot.title = element_text(face="bold", size=14, hjust=0))+
  theme(axis.title = element_text(face="bold", size=14))+ 
  theme(axis.text.x  = element_text(size=14),axis.text.y  = element_text(size=14))+
  theme(legend.text=element_text(size=14),legend.title=element_text(size=14))+
  scale_y_continuous(labels=percent,limits=c(-0.1,.1),breaks=seq(-0.1,0.1,0.02))+
  scale_x_continuous(limits=c(0,6000),breaks=seq(0,6000,500))+
  geom_ribbon(aes(ymin=AVGpupil-sePupil,ymax=AVGpupil+sePupil),alpha=0.5)+
  geom_vline(xintercept = aa, size = 1)+
  geom_vline(xintercept = a, linetype = "longdash")+
  scale_fill_manual(values=colortimes,name="Number of times seen", breaks=c("1", "2"),labels=c("1-7", "8-15"))+
  scale_colour_manual(values=colortimes)+
  guides(color=FALSE)+
  theme(legend.position = "bottom")
```

Limit timecourse analyses to first 5 trials
```{r}
b1 <- subset(poo2, timesseen < 6 & TIMECODE < 6001)
aa = c(0,1000)
a = 2000

c1 <- ddply(b1,.(subID,TIMECODE,trialtype),summarise,avg.pupil=mean(PUPIL_CORRECTED,na.rm = TRUE))
c11 <- ddply(c1,.(TIMECODE,trialtype),summarise,AVGpupil=mean(avg.pupil,na.rm = TRUE),sePupil=sd(avg.pupil, na.rm = TRUE)/sqrt(length(avg.pupil)))

#TIMECOURSE
ggplot(c11,aes(x=TIMECODE,y=AVGpupil,fill=factor(trialtype),colour=factor(trialtype)))+
  geom_line()+ggtitle("Timecourse (first 5 trials)")+
  theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),axis.line = element_line(colour = "black"))+
  labs(x = "Time (ms)", y = "Pupil change from baseline (%)")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  scale_y_continuous(labels=percent,limits=c(-0.1,.1),breaks=seq(-0.1,0.1,0.02))+
  scale_x_continuous(limits=c(0,6000),breaks=seq(0,6000,500))+
  geom_ribbon(aes(ymin=AVGpupil-sePupil,ymax=AVGpupil+sePupil),alpha=0.5)+
  scale_fill_manual(values=grouptrial,name="Trial Type", breaks=c("1", "2","3","4","5","6"),labels=c("A1V1", "A2V2", "A2--","--V2","A3--","--V3"))+
  scale_colour_manual(values=grouptrial)+guides(color=FALSE)+
  geom_vline(xintercept = aa, size = 1)+geom_vline(xintercept = a, linetype = "longdash")

#facet wrap
label <- c(`1` = "A1V1",`2` = "A2V2",`3` = "A2--",`4` = "--V2",`5` = "A3--",`6` = "--V3")
ggplot(c11,aes(x=TIMECODE,y=AVGpupil,fill=factor(trialtype),colour=factor(trialtype)))+
  geom_line()+ggtitle("Timecourse (first 5 trials)")+
  theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),axis.line = element_line(colour = "black"))+
  labs(x = "Time (ms)", y = "Pupil change from baseline (%)")+
  theme(plot.title = element_text(face="bold", size=14, hjust=0))+
  theme(axis.title = element_text(face="bold", size=14))+ 
  theme(axis.text.x  = element_text(size=14),axis.text.y  = element_text(size=14))+
  theme(legend.text=element_text(size=14),legend.title=element_text(size=14))+
  scale_y_continuous(labels=percent,limits=c(-0.1,.1),breaks=seq(-0.1,0.1,0.02))+
  scale_x_continuous(limits=c(0,6000),breaks=seq(0,6000,500))+
  geom_ribbon(aes(ymin=AVGpupil-sePupil,ymax=AVGpupil+sePupil),alpha=0.5)+
  theme(legend.position="none")+
  facet_wrap(~trialtype,ncol=2,labeller = as_labeller(label))+
  theme(strip.text = element_text(size=16))+
  scale_fill_manual(values=grouptrial)+scale_colour_manual(values=grouptrial)+
  geom_vline(xintercept = aa, size = 1)+geom_vline(xintercept = a, linetype = "longdash")

#Question 1: How does the PDR look for a visual omission?
doo3 <- subset(c11, trialtype < 4 & trialtype > 1) #trialtypes 2 and 3

ggplot(doo3,aes(x=TIMECODE,y=AVGpupil,fill=factor(trialtype),colour=factor(trialtype)))+
  geom_line()+ggtitle("A2V2 vs A2-- (first 5 trials)")+
  theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),axis.line = element_line(colour = "black"))+
  labs(x = "Time (ms)", y = "Pupil change from baseline (%)")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  scale_y_continuous(labels=percent,limits=c(-0.1,.1),breaks=seq(-0.1,0.1,0.02))+
  scale_x_continuous(limits=c(0,6000),breaks=seq(0,6000,500))+
  geom_ribbon(aes(ymin=AVGpupil-sePupil,ymax=AVGpupil+sePupil),alpha=0.3)+
  scale_fill_manual(values=colorVom,name="Trial Type", breaks=c("2", "3"),labels=c("A2V2", "A2--"))+guides(color=FALSE)+geom_vline(xintercept = aa, size = 1)+geom_vline(xintercept = a, linetype = "longdash")+scale_colour_manual(values=colorVom)

#Question 2: How does the PDR look for an auditory omission?
doo3 <- subset(c11, trialtype == 2 | trialtype == 4) #trialtypes 2 and 4

ggplot(doo3,aes(x=TIMECODE,y=AVGpupil,fill=factor(trialtype),colour=factor(trialtype)))+
  geom_line()+ggtitle("A2V2 vs --V2 (first 5 trials)")+
  theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),axis.line = element_line(colour = "black"))+
  labs(x = "Time (ms)", y = "Pupil change from baseline (%)")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  scale_y_continuous(labels=percent,limits=c(-0.1,.1),breaks=seq(-0.1,0.1,0.02))+
  scale_x_continuous(limits=c(0,6000),breaks=seq(0,6000,500))+
  geom_ribbon(aes(ymin=AVGpupil-sePupil,ymax=AVGpupil+sePupil),alpha=0.3)+
  scale_fill_manual(values=colorAom,name="Trial Type", breaks=c("2", "4"),labels=c("A2V2", "--V2"))+guides(color=FALSE)+geom_vline(xintercept = aa, size = 1)+geom_vline(xintercept = a, linetype = "longdash")+scale_colour_manual(values=colorAom)

#Question 3 : how does uncertainty influence pupil size?
#comparing A1V1 to A2V2, trialtype 1 and 2

doo3 <- subset(c11, trialtype < 3)

ggplot(doo3,aes(x=TIMECODE,y=AVGpupil,fill=factor(trialtype),colour=factor(trialtype)))+
  geom_line()+ggtitle("A1V1 vs A2V2 (first 5 trials)")+
  theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),axis.line = element_line(colour = "black"))+
  labs(x = "Time (ms)", y = "Pupil change from baseline (%)")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  scale_y_continuous(labels=percent,limits=c(-0.1,.1),breaks=seq(-0.1,0.1,0.02))+
  scale_x_continuous(limits=c(0,6000),breaks=seq(0,6000,500))+
  geom_ribbon(aes(ymin=AVGpupil-sePupil,ymax=AVGpupil+sePupil),alpha=0.3)+
  scale_fill_manual(values=colorAV,name="Trial Type", breaks=c("1", "2"),labels=c("A1V1", "A2V2"))+guides(color=FALSE)+geom_vline(xintercept = aa, size = 1)+geom_vline(xintercept = a, linetype = "longdash")+scale_colour_manual(values=colorAV)

#3B. Is it different for audio vs visual domain?
#comparing A2-- to A3--
doo4 <- subset(c11, trialtype== 3 | trialtype== 5)

ggplot(doo4,aes(x=TIMECODE,y=AVGpupil,fill=factor(trialtype),colour=factor(trialtype)))+
  geom_line()+ggtitle("A2-- to A3-- (first 5 trials)")+
  theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),axis.line = element_line(colour = "black"))+
  labs(x = "Time (ms)", y = "Pupil change from baseline (%)")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  scale_y_continuous(labels=percent,limits=c(-0.1,.1),breaks=seq(-0.1,0.1,0.02))+
  scale_x_continuous(limits=c(0,6000),breaks=seq(0,6000,500))+
  geom_ribbon(aes(ymin=AVGpupil-sePupil,ymax=AVGpupil+sePupil),alpha=0.3)+
  scale_fill_manual(values=colorA,name="Trial Type", breaks=c("3","5"),labels=c("A2--","A3--"))+
  guides(color=FALSE)+geom_vline(xintercept = aa, size = 1)+geom_vline(xintercept = a, linetype = "longdash")+scale_colour_manual(values=colorA)

#comparing V2-- to V3--
doo5 <- subset(c11, trialtype== 4 | trialtype== 6)

ggplot(doo5,aes(x=TIMECODE,y=AVGpupil,fill=factor(trialtype),colour=factor(trialtype)))+
  geom_line()+ggtitle("V2-- to V3-- (first 5 trials)")+
  theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),axis.line = element_line(colour = "black"))+
  labs(x = "Time (ms)", y = "Pupil change from baseline (%)")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  scale_y_continuous(labels=percent,limits=c(-0.1,.1),breaks=seq(-0.1,0.1,0.02))+
  scale_x_continuous(limits=c(0,6000),breaks=seq(0,6000,500))+
  geom_ribbon(aes(ymin=AVGpupil-sePupil,ymax=AVGpupil+sePupil),alpha=0.3)+
  scale_fill_manual(values=colorV,name="Trial Type", breaks=c("4","6"),labels=c("--V2","--V3"))+
  guides(color=FALSE)+geom_vline(xintercept = aa, size = 1)+geom_vline(xintercept = a, linetype = "longdash")+scale_colour_manual(values=colorV)

#Question 4 : how does familiarity influence pupil size?
#4B. Is it different for audio vs visual domain?
z1 <- subset(poo2, timesseen < 4 & TIMECODE < 6001) #group 1:1-3
z2 <- subset(poo2, timesseen > 3 & timesseen < 6 & TIMECODE < 6001) #group 2:4-5

aa = c(0,1000)
a = 2000

y1 <- ddply(z1,.(subID,TIMECODE,trialtype),summarise,avg.pupil=mean(PUPIL_CORRECTED,na.rm = TRUE))
y11 <- ddply(y1,.(TIMECODE,trialtype),summarise,AVGpupil=mean(avg.pupil,na.rm = TRUE),sePupil=sd(avg.pupil, na.rm = TRUE)/sqrt(length(avg.pupil)))
y11$group <- 1

y2 <- ddply(z2,.(subID,TIMECODE,trialtype),summarise,avg.pupil=mean(PUPIL_CORRECTED,na.rm = TRUE))
y21 <- ddply(y2,.(TIMECODE,trialtype),summarise,AVGpupil=mean(avg.pupil,na.rm = TRUE),sePupil=sd(avg.pupil, na.rm = TRUE)/sqrt(length(avg.pupil)))
y21$group <- 2

yfinal <- rbind(y11,y21)

label <- c(`1` = "A1V1",`2` = "A2V2",`3` = "A2--",`4` = "--V2",`5` = "A3--",`6` = "--V3")

#look at familiarity for different trial types
ggplot(yfinal,aes(x=TIMECODE,y=AVGpupil,fill=factor(group),colour=factor(group)))+
  geom_line()+
  theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),axis.line = element_line(colour = "black"))+
  labs(x = "Time (ms)", y = "Pupil change from baseline (%)")+
  theme(plot.title = element_text(face="bold", size=14, hjust=0))+
  theme(axis.title = element_text(face="bold", size=14))+ 
  theme(axis.text.x  = element_text(size=14),axis.text.y  = element_text(size=14))+
  theme(legend.text=element_text(size=14),legend.title=element_text(size=14))+
  scale_y_continuous(labels=percent,limits=c(-0.15,.15),breaks=seq(-0.15,0.15,0.03))+
  scale_x_continuous(limits=c(0,6000),breaks=seq(0,6000,500))+
  geom_ribbon(aes(ymin=AVGpupil-sePupil,ymax=AVGpupil+sePupil),alpha=0.5)+
  facet_wrap(~trialtype,ncol=2,labeller = as_labeller(label))+
  theme(strip.text = element_text(size=16))+
  geom_vline(xintercept = aa, size = 1)+
  geom_vline(xintercept = a, linetype = "longdash")+
  scale_fill_manual(values=colortimes,name="Number of times seen", breaks=c("1", "2"),labels=c("1-3", "4-5"))+
  scale_colour_manual(values=colortimes)+
  guides(color=FALSE)+
  theme(legend.position = "bottom")

y1 <- ddply(z1,.(subID,TIMECODE),summarise,avg.pupil=mean(PUPIL_CORRECTED,na.rm = TRUE))
y11 <- ddply(y1,.(TIMECODE),summarise,AVGpupil=mean(avg.pupil,na.rm = TRUE),sePupil=sd(avg.pupil, na.rm = TRUE)/sqrt(length(avg.pupil)))
y11$group <- 1

y2 <- ddply(z2,.(subID,TIMECODE),summarise,avg.pupil=mean(PUPIL_CORRECTED,na.rm = TRUE))
y21 <- ddply(y2,.(TIMECODE),summarise,AVGpupil=mean(avg.pupil,na.rm = TRUE),sePupil=sd(avg.pupil, na.rm = TRUE)/sqrt(length(avg.pupil)))
y21$group <- 2

yfinal <- rbind(y11,y21)

#group all trial types together
ggplot(yfinal,aes(x=TIMECODE,y=AVGpupil,fill=factor(group),colour=factor(group)))+
  geom_line()+
  theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),axis.line = element_line(colour = "black"))+
  labs(x = "Time (ms)", y = "Pupil change from baseline (%)")+
  theme(plot.title = element_text(face="bold", size=14, hjust=0))+
  theme(axis.title = element_text(face="bold", size=14))+ 
  theme(axis.text.x  = element_text(size=14),axis.text.y  = element_text(size=14))+
  theme(legend.text=element_text(size=14),legend.title=element_text(size=14))+
  scale_y_continuous(labels=percent,limits=c(-0.1,.1),breaks=seq(-0.1,0.1,0.02))+
  scale_x_continuous(limits=c(0,6000),breaks=seq(0,6000,500))+
  geom_ribbon(aes(ymin=AVGpupil-sePupil,ymax=AVGpupil+sePupil),alpha=0.5)+
  geom_vline(xintercept = aa, size = 1)+
  geom_vline(xintercept = a, linetype = "longdash")+
  scale_fill_manual(values=colortimes,name="Number of times seen", breaks=c("1", "2"),labels=c("1-3", "4-5"))+
  scale_colour_manual(values=colortimes)+
  guides(color=FALSE)+
  theme(legend.position = "bottom")
```

Limit timecourse analyses to first 10 trials
```{r}
b1 <- subset(poo2, timesseen < 11 & TIMECODE < 6001)
aa = c(0,1000)
a = 2000

c1 <- ddply(b1,.(subID,TIMECODE,trialtype),summarise,avg.pupil=mean(PUPIL_CORRECTED,na.rm = TRUE))
c11 <- ddply(c1,.(TIMECODE,trialtype),summarise,AVGpupil=mean(avg.pupil,na.rm = TRUE),sePupil=sd(avg.pupil, na.rm = TRUE)/sqrt(length(avg.pupil)))

#TIMECOURSE
ggplot(c11,aes(x=TIMECODE,y=AVGpupil,fill=factor(trialtype),colour=factor(trialtype)))+
  geom_line()+ggtitle("Timecourse (first 10 trials)")+
  theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),axis.line = element_line(colour = "black"))+
  labs(x = "Time (ms)", y = "Pupil change from baseline (%)")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  scale_y_continuous(labels=percent,limits=c(-0.1,.1),breaks=seq(-0.1,0.1,0.02))+
  scale_x_continuous(limits=c(0,6000),breaks=seq(0,6000,500))+
  geom_ribbon(aes(ymin=AVGpupil-sePupil,ymax=AVGpupil+sePupil),alpha=0.5)+
  scale_fill_manual(values=grouptrial,name="Trial Type", breaks=c("1", "2","3","4","5","6"),labels=c("A1V1", "A2V2", "A2--","--V2","A3--","--V3"))+
  scale_colour_manual(values=grouptrial)+guides(color=FALSE)+
  geom_vline(xintercept = aa, size = 1)+geom_vline(xintercept = a, linetype = "longdash")

#facet wrap
label <- c(`1` = "A1V1",`2` = "A2V2",`3` = "A2--",`4` = "--V2",`5` = "A3--",`6` = "--V3")
ggplot(c11,aes(x=TIMECODE,y=AVGpupil,fill=factor(trialtype),colour=factor(trialtype)))+
  geom_line()+ggtitle("Timecourse (first 10 trials)")+
  theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),axis.line = element_line(colour = "black"))+
  labs(x = "Time (ms)", y = "Pupil change from baseline (%)")+
  theme(plot.title = element_text(face="bold", size=14, hjust=0))+
  theme(axis.title = element_text(face="bold", size=14))+ 
  theme(axis.text.x  = element_text(size=14),axis.text.y  = element_text(size=14))+
  theme(legend.text=element_text(size=14),legend.title=element_text(size=14))+
  scale_y_continuous(labels=percent,limits=c(-0.1,.1),breaks=seq(-0.1,0.1,0.02))+
  scale_x_continuous(limits=c(0,6000),breaks=seq(0,6000,500))+
  geom_ribbon(aes(ymin=AVGpupil-sePupil,ymax=AVGpupil+sePupil),alpha=0.5)+
  theme(legend.position="none")+
  facet_wrap(~trialtype,ncol=2,labeller = as_labeller(label))+
  theme(strip.text = element_text(size=16))+
  scale_fill_manual(values=grouptrial)+scale_colour_manual(values=grouptrial)+
  geom_vline(xintercept = aa, size = 1)+geom_vline(xintercept = a, linetype = "longdash")

#Question 1: How does the PDR look for a visual omission?
doo3 <- subset(c11, trialtype < 4 & trialtype > 1) #trialtypes 2 and 3

ggplot(doo3,aes(x=TIMECODE,y=AVGpupil,fill=factor(trialtype),colour=factor(trialtype)))+
  geom_line()+ggtitle("A2V2 vs A2-- (first 10 trials)")+
  theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),axis.line = element_line(colour = "black"))+
  labs(x = "Time (ms)", y = "Pupil change from baseline (%)")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  scale_y_continuous(labels=percent,limits=c(-0.1,.1),breaks=seq(-0.1,0.1,0.02))+
  scale_x_continuous(limits=c(0,6000),breaks=seq(0,6000,500))+
  geom_ribbon(aes(ymin=AVGpupil-sePupil,ymax=AVGpupil+sePupil),alpha=0.3)+
  scale_fill_manual(values=colorVom,name="Trial Type", breaks=c("2", "3"),labels=c("A2V2", "A2--"))+guides(color=FALSE)+geom_vline(xintercept = aa, size = 1)+geom_vline(xintercept = a, linetype = "longdash")+scale_colour_manual(values=colorVom)

#Question 2: How does the PDR look for an auditory omission?
doo3 <- subset(c11, trialtype == 2 | trialtype == 4) #trialtypes 2 and 4

ggplot(doo3,aes(x=TIMECODE,y=AVGpupil,fill=factor(trialtype),colour=factor(trialtype)))+
  geom_line()+ggtitle("A2V2 vs --V2 (first 10 trials)")+
  theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),axis.line = element_line(colour = "black"))+
  labs(x = "Time (ms)", y = "Pupil change from baseline (%)")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  scale_y_continuous(labels=percent,limits=c(-0.1,.1),breaks=seq(-0.1,0.1,0.02))+
  scale_x_continuous(limits=c(0,6000),breaks=seq(0,6000,500))+
  geom_ribbon(aes(ymin=AVGpupil-sePupil,ymax=AVGpupil+sePupil),alpha=0.3)+
  scale_fill_manual(values=colorAom,name="Trial Type", breaks=c("2", "4"),labels=c("A2V2", "--V2"))+guides(color=FALSE)+geom_vline(xintercept = aa, size = 1)+geom_vline(xintercept = a, linetype = "longdash")+scale_colour_manual(values=colorAom)

#Question 3 : how does uncertainty influence pupil size?
#comparing A1V1 to A2V2, trialtype 1 and 2

doo3 <- subset(c11, trialtype < 3)

ggplot(doo3,aes(x=TIMECODE,y=AVGpupil,fill=factor(trialtype),colour=factor(trialtype)))+
  geom_line()+ggtitle("A1V1 vs A2V2 (first 10 trials)")+
  theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),axis.line = element_line(colour = "black"))+
  labs(x = "Time (ms)", y = "Pupil change from baseline (%)")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  scale_y_continuous(labels=percent,limits=c(-0.1,.1),breaks=seq(-0.1,0.1,0.02))+
  scale_x_continuous(limits=c(0,6000),breaks=seq(0,6000,500))+
  geom_ribbon(aes(ymin=AVGpupil-sePupil,ymax=AVGpupil+sePupil),alpha=0.3)+
  scale_fill_manual(values=colorAV,name="Trial Type", breaks=c("1", "2"),labels=c("A1V1", "A2V2"))+guides(color=FALSE)+geom_vline(xintercept = aa, size = 1)+geom_vline(xintercept = a, linetype = "longdash")+scale_colour_manual(values=colorAV)

#3B. Is it different for audio vs visual domain?
#comparing A2-- to A3--
doo4 <- subset(c11, trialtype== 3 | trialtype== 5)

ggplot(doo4,aes(x=TIMECODE,y=AVGpupil,fill=factor(trialtype),colour=factor(trialtype)))+
  geom_line()+ggtitle("A2-- to A3-- (first 10 trials)")+
  theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),axis.line = element_line(colour = "black"))+
  labs(x = "Time (ms)", y = "Pupil change from baseline (%)")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  scale_y_continuous(labels=percent,limits=c(-0.1,.1),breaks=seq(-0.1,0.1,0.02))+
  scale_x_continuous(limits=c(0,6000),breaks=seq(0,6000,500))+
  geom_ribbon(aes(ymin=AVGpupil-sePupil,ymax=AVGpupil+sePupil),alpha=0.3)+
  scale_fill_manual(values=colorA,name="Trial Type", breaks=c("3","5"),labels=c("A2--","A3--"))+
  guides(color=FALSE)+geom_vline(xintercept = aa, size = 1)+geom_vline(xintercept = a, linetype = "longdash")+scale_colour_manual(values=colorA)

#comparing V2-- to V3--
doo5 <- subset(c11, trialtype== 4 | trialtype== 6)

ggplot(doo5,aes(x=TIMECODE,y=AVGpupil,fill=factor(trialtype),colour=factor(trialtype)))+
  geom_line()+ggtitle("V2-- to V3-- (first 10 trials)")+
  theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),axis.line = element_line(colour = "black"))+
  labs(x = "Time (ms)", y = "Pupil change from baseline (%)")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  scale_y_continuous(labels=percent,limits=c(-0.1,.1),breaks=seq(-0.1,0.1,0.02))+
  scale_x_continuous(limits=c(0,6000),breaks=seq(0,6000,500))+
  geom_ribbon(aes(ymin=AVGpupil-sePupil,ymax=AVGpupil+sePupil),alpha=0.3)+
  scale_fill_manual(values=colorV,name="Trial Type", breaks=c("4","6"),labels=c("--V2","--V3"))+
  guides(color=FALSE)+geom_vline(xintercept = aa, size = 1)+geom_vline(xintercept = a, linetype = "longdash")+scale_colour_manual(values=colorV)

#Question 4 : how does familiarity influence pupil size?
#4B. Is it different for audio vs visual domain?
z1 <- subset(poo2, timesseen < 6 & TIMECODE < 6001) #group 1:1-5
z2 <- subset(poo2, timesseen > 5 & timesseen < 11 & TIMECODE < 6001) #group 2:6-10 

aa = c(0,1000)
a = 2000

y1 <- ddply(z1,.(subID,TIMECODE,trialtype),summarise,avg.pupil=mean(PUPIL_CORRECTED,na.rm = TRUE))
y11 <- ddply(y1,.(TIMECODE,trialtype),summarise,AVGpupil=mean(avg.pupil,na.rm = TRUE),sePupil=sd(avg.pupil, na.rm = TRUE)/sqrt(length(avg.pupil)))
y11$group <- 1

y2 <- ddply(z2,.(subID,TIMECODE,trialtype),summarise,avg.pupil=mean(PUPIL_CORRECTED,na.rm = TRUE))
y21 <- ddply(y2,.(TIMECODE,trialtype),summarise,AVGpupil=mean(avg.pupil,na.rm = TRUE),sePupil=sd(avg.pupil, na.rm = TRUE)/sqrt(length(avg.pupil)))
y21$group <- 2

yfinal <- rbind(y11,y21)

label <- c(`1` = "A1V1",`2` = "A2V2",`3` = "A2--",`4` = "--V2",`5` = "A3--",`6` = "--V3")

#look at familiarity for different trial types
ggplot(yfinal,aes(x=TIMECODE,y=AVGpupil,fill=factor(group),colour=factor(group)))+
  geom_line()+
  theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),axis.line = element_line(colour = "black"))+
  labs(x = "Time (ms)", y = "Pupil change from baseline (%)")+
  theme(plot.title = element_text(face="bold", size=14, hjust=0))+
  theme(axis.title = element_text(face="bold", size=14))+ 
  theme(axis.text.x  = element_text(size=14),axis.text.y  = element_text(size=14))+
  theme(legend.text=element_text(size=14),legend.title=element_text(size=14))+
  scale_y_continuous(labels=percent,limits=c(-0.15,.15),breaks=seq(-0.15,0.15,0.03))+
  scale_x_continuous(limits=c(0,6000),breaks=seq(0,6000,500))+
  geom_ribbon(aes(ymin=AVGpupil-sePupil,ymax=AVGpupil+sePupil),alpha=0.5)+
  facet_wrap(~trialtype,ncol=2,labeller = as_labeller(label))+
  theme(strip.text = element_text(size=16))+
  geom_vline(xintercept = aa, size = 1)+
  geom_vline(xintercept = a, linetype = "longdash")+
  scale_fill_manual(values=colortimes,name="Number of times seen", breaks=c("1", "2"),labels=c("1-5", "6-10"))+
  scale_colour_manual(values=colortimes)+
  guides(color=FALSE)+
  theme(legend.position = "bottom")

y1 <- ddply(z1,.(subID,TIMECODE),summarise,avg.pupil=mean(PUPIL_CORRECTED,na.rm = TRUE))
y11 <- ddply(y1,.(TIMECODE),summarise,AVGpupil=mean(avg.pupil,na.rm = TRUE),sePupil=sd(avg.pupil, na.rm = TRUE)/sqrt(length(avg.pupil)))
y11$group <- 1

y2 <- ddply(z2,.(subID,TIMECODE),summarise,avg.pupil=mean(PUPIL_CORRECTED,na.rm = TRUE))
y21 <- ddply(y2,.(TIMECODE),summarise,AVGpupil=mean(avg.pupil,na.rm = TRUE),sePupil=sd(avg.pupil, na.rm = TRUE)/sqrt(length(avg.pupil)))
y21$group <- 2

yfinal <- rbind(y11,y21)

#group all trial types together
ggplot(yfinal,aes(x=TIMECODE,y=AVGpupil,fill=factor(group),colour=factor(group)))+
  geom_line()+
  theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),axis.line = element_line(colour = "black"))+
  labs(x = "Time (ms)", y = "Pupil change from baseline (%)")+
  theme(plot.title = element_text(face="bold", size=14, hjust=0))+
  theme(axis.title = element_text(face="bold", size=14))+ 
  theme(axis.text.x  = element_text(size=14),axis.text.y  = element_text(size=14))+
  theme(legend.text=element_text(size=14),legend.title=element_text(size=14))+
  scale_y_continuous(labels=percent,limits=c(-0.1,.1),breaks=seq(-0.1,0.1,0.02))+
  scale_x_continuous(limits=c(0,6000),breaks=seq(0,6000,500))+
  geom_ribbon(aes(ymin=AVGpupil-sePupil,ymax=AVGpupil+sePupil),alpha=0.5)+
  geom_vline(xintercept = aa, size = 1)+
  geom_vline(xintercept = a, linetype = "longdash")+
  scale_fill_manual(values=colortimes,name="Number of times seen", breaks=c("1", "2"),labels=c("1-5", "6-10"))+
  scale_colour_manual(values=colortimes)+
  guides(color=FALSE)+
  theme(legend.position = "bottom")

```